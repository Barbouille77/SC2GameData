include "TriggerLibs/HeroesLib"

//--------------------------------------------------------------------------------------------------
// Library: Blackheart's Bay (Mod)
//--------------------------------------------------------------------------------------------------
// Preset Declarations
const int libBBAY_ge_MMBBMapMechanicsBlackheartsBayModes_Doubloons = 0;
const int libBBAY_ge_MMBBMapMechanicsBlackheartsBayModes_Cannon = 1;
const int libBBAY_ge_MMBBCannonballsState_Starting = 0;
const int libBBAY_ge_MMBBCannonballsState_Paying = 1;
const int libBBAY_ge_MMBBCannonballsState_Shooting = 2;
const int libBBAY_ge_MMBBHeroAIGhostShipBeaconStatus_Closed = 0;
const int libBBAY_ge_MMBBHeroAIGhostShipBeaconStatus_Open = 1;
const int libBBAY_ge_MMBBHeroAIStates_MMBlackheartsBayPickUpDoubloon = 0;
const int libBBAY_ge_MMBBHeroAIStates_MMBlackheartsBayTurnInDoubloons = 1;
const int libBBAY_ge_MMBBHeroAIStates_MMBlackheartsBayTurnInDoubloonsDefend = 2;
const int libBBAY_ge_MMBBHeroAIStates_MMBlackheartsBayTreasureChestMoveToChest = 3;
const int libBBAY_ge_MMBBHeroAIStates_MMBlackheartsBayTreasureChestAttackChest = 4;
const int libBBAY_ge_MMBBHeroAIStates_MMBlackheartsBayTreasureChestDefend = 5;

// Constants
const string libBBAY_gv_mMBBCannonballsMechanicName_C = "BlackheartsBay";
const int libBBAY_gv_mMBBCannonballsStartInBattleship_C = 0;
const int libBBAY_gv_mMBBCannonballsBallsSubmitMax_C = 10;
const int libBBAY_gv_mMBBCannonballsBallsSubmitMaxInc_C = 2;
const int libBBAY_gv_mMBBCannonballsStockedInBattleship_C = 12;
const int libBBAY_gv_mMBBShotsPerBarrage_C = 3;
const int libBBAY_gv_mMBBCannonballsHeroStatusBarIconVisibleThreadhold_C = 1;
const fixed libBBAY_gv_mMBBCannonballsTreasureChestFirstTimerDur_C = 50.0;
const fixed libBBAY_gv_mMBBCannonballsTreasureChestTimerMin_C = 150.0;
const fixed libBBAY_gv_mMBBCannonballsTreasureChestTimerMax_C = 210.0;
const int libBBAY_gv_mMBBCannonballsGhostChestCoinsDrop_C = 5;
const int libBBAY_gv_mMBBCannonballsTreasureChestMaxCount_C = 2;
const fixed libBBAY_gv_mMBBCannonballsTreasureChestPingTimerTime = 15.0;
const int libBBAY_gv_mMBBMapMechanicsBlackheartsBayCannonballCount_C = 12;
const fixed libBBAY_gv_mMBBMapMechanicsBlackheartsBayChestsSpawnedFrameTimerDuration_C = 8.0;
const fixed libBBAY_gv_aIMMBBHeroDoubloonSearchRadius = 12.0;
const fixed libBBAY_gv_aIMMBBHeroDoubloonCloseToEnemyDistance = 6.0;
const int libBBAY_gv_aIMMBBHeroWantToTurnInDoubloonsAmountHumanTeam = 3;
const int libBBAY_gv_aIMMBBHeroWantToTurnInDoubloonsAmountAllAITeam = 4;
const fixed libBBAY_gv_aIMMBBHeroTurnInDoubloonsInterruptedTimeout = 45.0;
const fixed libBBAY_gv_aIMMBBHeroTurnInDoubloonsConsiderFrequency = 15.0;
const fixed libBBAY_gv_aIMMBBHeroWalkDirectlyToGhostShipBeaconDistance = 50.0;
const fixed libBBAY_gv_aIMMBBHeroCloseToGhostShipBeaconDistance = 12.0;
const fixed libBBAY_gv_aIMMBBHeroFarFromGhostShipBeaconDistance = 15.0;
const fixed libBBAY_gv_aIMMBBHeroAttackChestConsiderDelay = 3.0;
const fixed libBBAY_gv_aIMMBBHeroTreasureChestPingedRecruitDistance = 35.0;
const fixed libBBAY_gv_aIMMBBHeroTreasureChestRecruitDistance = 20.0;
const fixed libBBAY_gv_aIMMBBHeroCloseToTreasureChestDistance = 10.0;
const fixed libBBAY_gv_aIMMBBHeroFarFromTreasureChestDistance = 13.0;
const fixed libBBAY_gv_aIMMBBHeroStandNearTreasureChestDistance = 6.0;
const fixed libBBAY_gv_aIMMBBHeroNearDoubloonDistance = 7.0;

// Structures
struct libBBAY_gs_HeroAIGhostShipStatus {
    int lv_beaconStatus;
    unit lv_beaconUnit;
    int[libCore_gv_bALMaxTeams + 1] lv_doubloonsTurnedIn;
};

// Variable Declarations
point libBBAY_gv_mMBBCannonballsGhostShipLoc;
fixed libBBAY_gv_mMBBCannonballsGhostShipSpawnTimer;
point libBBAY_gv_mMBBCannonballsGhostShipBeaconLoc;
int[3] libBBAY_gv_mMBBCannonballsBallsSubmitMaxCurrent;
bool[libCore_gv_bALMaxPlayers + 1] libBBAY_gv_mMBBTurnInUsed;
bool[libCore_gv_bALMaxPlayers + 1] libBBAY_gv_mMBBChestsAttacked;
unit libBBAY_gv_mMBBBlackheartsLootBannerSconce;
unit libBBAY_gv_mMBBCannonballsGhostShip;
int libBBAY_gv_mMBBCannonballsGhostShipTotalAmmo;
int[3] libBBAY_gv_mMBBCannonballsGhostShipTargetTownIndex;
int[3][21] libBBAY_gv_mMBBCannonballsGhostShipTargetTownOrders;
int[3] libBBAY_gv_mMBBCannonballsGhostShipTargetTownOrdersCount;
unit libBBAY_gv_mMBBCannonballsGhostShipMissile;
int libBBAY_gv_mMBBCannonballsGhostShipMissileTargetPing;
bool libBBAY_gv_mMBBCannonballsGhostShipShooting;
unit libBBAY_gv_mMBBCannonballsGhostShipBeacon;
unit libBBAY_gv_mMBBCannonballsGhostShipCaptain;
point libBBAY_gv_mMBBCannonballsGhostShipCaptainWorkPoint;
region libBBAY_gv_mMBBCannonballsGhostShipPlayerDetectorRegion;
int[3] libBBAY_gv_mMBBCannonballsBallsSubmitted;
int libBBAY_gv_mMBBCannonballsGhostShipActivationCount;
int libBBAY_gv_mMBBCannonballsGhostShipLastTeam;
unit[13] libBBAY_gv_mMBB_CannonTarget;
point[13] libBBAY_gv_mMBB_CannonTargetPoint;
int libBBAY_gv_mMBB_CannonsFired;
point[libBBAY_gv_mMBBCannonballsTreasureChestMaxCount_C + 1] libBBAY_gv_mMBBCannonballsGhostChestLocations;
timer libBBAY_gv_mMBBCannonballsTreasureChestTimer;
unit[libBBAY_gv_mMBBCannonballsTreasureChestMaxCount_C + 1] libBBAY_gv_mMBBCannonballsTreasureChestChests;
timer libBBAY_gv_mMBBCannonballsTreasureChestPingTimer;
bool libBBAY_gv_mMBBCannonballsTreasureChestIsFirstChest;
timer libBBAY_gv_mMBBMapMechanicsBlackheartsBayChestsSpawnedFrameTimer;
int libBBAY_gv_mMBBMapMechanicsBlackheartsBayCurrentMode;
int[libCore_gv_bALMaxPlayers + 1] libBBAY_gv_mMBBDoubloonsCollected;
int[libCore_gv_bALMaxPlayers + 1] libBBAY_gv_mMBBDoubloonsDropped;
int[libCore_gv_bALMaxPlayers + 1] libBBAY_gv_mMBBDoubloonsTurnedIn;
int[libCore_gv_bALMaxTeams + 1] libBBAY_gv_mMBBEventsStarted;
libBBAY_gs_HeroAIGhostShipStatus libBBAY_gv_heroAIGhostShipStatus;
unitgroup libBBAY_gv_heroAITreasureChests;
bool libBBAY_gv_mMBBCannonballsTrasmissionPlaying;
int libBBAY_gv_mMBBCannonballsTransmissionFiringIndex;
int libBBAY_gv_mMBBCannonballsTransmissionFiringRandomness;
bool libBBAY_gv_mMBBCannonballsMapEventDisabled;

// Function Declarations
void libBBAY_gf_MMBBCannonballsInitGhostshipInfo (point lp_shipLoc, point lp_beaconLoc);
void libBBAY_gf_MMBBCannonballsInitTreasureChestInfo (point lp_chestLocation1, point lp_chestLocation2);
int libBBAY_gf_MMBBCannonballsHeroCannonballsCount (int lp_player, unit lp_heroUnit);
int libBBAY_gf_MMBBCannonballsPirateShipCost (int lp_team);
void libBBAY_gf_MMBBCannonballsAddGhostShipTargetOrder (int lp_team, int lp_townIndex);
int libBBAY_gf_MMBBCannonballsTeamCannonballsCount (int lp_team);
int libBBAY_gf_MMBBCannonballsCurrentlyCarriedforTeam (int lp_team);
void libBBAY_gf_MMBBCannonballsSubmitReqIncrease (int lp_team);
void libBBAY_gf_MMBBCannonballsSetHeroCannonballsCount (int lp_player, unit lp_heroUnit, int lp_count);
void libBBAY_gf_MMBBCannonballsGhostShipWakeUp (int lp_team, bool lp_new);
void libBBAY_gf_MMBBCannonballsDisableBeacon ();
void libBBAY_gf_MMBBCannonballsBattleshipBehavior ();
int libBBAY_gf_MMBBCannonballsBattleshipAmmoLeft ();
unit libBBAY_gf_MMBBCannonballsBattleshipNextTarget ();
void libBBAY_gf_MMBBCannonballsBattleshipShooting (unit lp_target);
bool libBBAY_gf_MMBBCannonballsTownAlive (int lp_town, int lp_player);
void libBBAY_gf_MMBBCannonballsBattleshipShootingShakingCamera (point lp_targetLocation);
text libBBAY_gf_MMBBCannonballsTreasureSetTextTagHelp ();
text libBBAY_gf_MMBBCannonballsTreasureSetTextTagDoubloonCount (int lp_coins);
void libBBAY_gf_MMBBCannonballsTreasureTheFirstTimer ();
void libBBAY_gf_MMBBCannonballsTreasureStartTimer ();
void libBBAY_gf_MMBBMapMechanicsBlackheartsBayShowHidePanel (bool lp_showHide);
void libBBAY_gf_MMBBMapMechanicsBlackheartsBaySetMode (int lp_mode);
void libBBAY_gf_MMBBMapMechanicsBlackheartsBayShowChestsSpawnedFrame ();
void libBBAY_gf_MMBBMapMechanicsBlackheartsBayShowCannonballForTeam (int lp_team);
void libBBAY_gf_MMBBMapMechanicsBlackheartsBaySetDoubloonCountForTeam (int lp_count, int lp_maxCount, int lp_team);
void libBBAY_gf_MMBBMapMechanicsBlackheartsBaySetShotCountForTeam (int lp_count, int lp_team);
void libBBAY_gf_MMBBUpdateHeldDoubloonDisplay ();
void libBBAY_gf_MMBBCannonballsObjectiveUIUpdateText ();
void libBBAY_gf_MMBBHeroAIGhostShipShowsUp (unit lp_ship);
void libBBAY_gf_MMBBHeroAIGhostShipShootingStarts (int lp_player);
void libBBAY_gf_MMBBHeroAIDoubloonsTurnedIn (int lp_player, int lp_count);
void libBBAY_gf_MMBBHeroAITreasureChestsSpawns (unit lp_treasureChest);
void libBBAY_gf_MMBBHeroAIGhostShipBeaconPinged (int lp_pingingPlayer);
void libBBAY_gf_MMBBHeroAITurnInDoubloonsLogic (int lp_faction);
bool libBBAY_gf_MMBBHeroAIShouldTurnInDoubloons (int lp_trigPlayer, bool lp_playerPinged);
bool libBBAY_gf_MMBBHeroAIShouldGiveUpOnTurningInDoubloons (int lp_trigPlayer);
void libBBAY_gf_MMBBHeroAIStartMovingToTurnInDoubloons (int lp_trigPlayer);
void libBBAY_gf_MMBBHeroAIPickUpDoubloonsLogic (int lp_faction);
unit libBBAY_gf_MMBBHeroAISearchForNearbyDoubloon (int lp_trigPlayer);
bool libBBAY_gf_MMBBHeroAIIsAllyPickingUpDoubloon (int lp_trigPlayer, unit lp_doubloon);
bool libBBAY_gf_MMBBHeroAIIsHumanAllyPickingUpDoubloon (int lp_trigPlayer, unit lp_doubloon);
void libBBAY_gf_MMBBHeroAITreasureChestPinged (int lp_pingingPlayer, unit lp_pingedChest);
void libBBAY_gf_MMBBHeroAIAttackTreasureChestLogic (int lp_faction);
void libBBAY_gf_MMBBHeroAIRecruitTeamforTreasureChest (int lp_teamIndex, unit lp_treasureChest, bool lp_wasPinged);
bool libBBAY_gf_MMBBHeroAIShouldAttackTreasureChest (int lp_trigPlayer, unit lp_treasureChest, bool lp_wasPinged);
bool libBBAY_gf_MMBBHeroAIShouldGiveUpOnTreasureChest (int lp_trigPlayer);
void libBBAY_gf_MMBBHeroAIChangeToState (int lp_trigPlayer, int lp_state, unit lp_target, int lp_priority);
int libBBAY_gf_MMBBHeroAIPickUpDoubloon (int lp_trigPlayer);
int libBBAY_gf_MMBBHeroAITurnInDoubloons (int lp_trigPlayer);
int libBBAY_gf_MMBBHeroAITurnInDoubloonsDefend (int lp_trigPlayer);
int libBBAY_gf_MMBBHeroAITreasureChestMoveToChest (int lp_trigPlayer);
int libBBAY_gf_MMBBHeroAITreasureChestAttackChest (int lp_trigPlayer);
int libBBAY_gf_MMBBHeroAITreasureChestDefend (int lp_trigPlayer);
void libBBAY_gf_MMBBCannonballsTransmissionSpawningQ (playergroup lp_players);
void libBBAY_gf_MMBBCannonballsTransmissionSummonedQ (int lp_shipTeam);
void libBBAY_gf_MMBBCannonballsTransmissionFiringQ (playergroup lp_players);
void libBBAY_gf_MMBBCannonballsTransmissionLeavingQ (playergroup lp_players);
void libBBAY_gf_MMBBCannonballsTransmissionChestSpawningFirstQ (playergroup lp_players);
void libBBAY_gf_MMBBCannonballsTransmissionChestSpawningRepeatQ (playergroup lp_players);

// Trigger Declarations
trigger libBBAY_gt_MMBBCannonballsInit;
trigger libBBAY_gt_MMBBPingDataInit;
trigger libBBAY_gt_MMBBCannonballsHeroSpawned;
trigger libBBAY_gt_MMBBCannonballsHeroMapMechanicStatusSetup;
trigger libBBAY_gt_MMBBCannonballsHeroDies;
trigger libBBAY_gt_MMBBCannonballsHeroRespawns;
trigger libBBAY_gt_MMBBCannonballsGatesAreOpenComplete;
trigger libBBAY_gt_MMBBCannonballsEventStart;
trigger libBBAY_gt_MMBBCannonballsHeroPickup;
trigger libBBAY_gt_MMBBCannonballsBallsHandedIn;
trigger libBBAY_gt_MMBBCannonballsCreepRewards;
trigger libBBAY_gt_MMBBCannonballsOpenChestUponRespawn;
trigger libBBAY_gt_MMBBCannonballsBattleshipShootingMissileCreated;
trigger libBBAY_gt_MMBBCannonballsBattleshipKilledATown;
trigger libBBAY_gt_MMBBKeepOrFortGetsTakenOver;
trigger libBBAY_gt_MMBBCannonballsTreasureSpawnChests;
trigger libBBAY_gt_MMBBCannonballsTreasureChestSpawnsDoubloon;
trigger libBBAY_gt_MMBBCannonballsTreasureChestPingTimerExpires;
trigger libBBAY_gt_MMBBCannonballsTreasureAChestDies;
trigger libBBAY_gt_MMBBCannonballsTreasureChestsAreDead;
trigger libBBAY_gt_MMBBCannonballsTreasureChestAttacked;
trigger libBBAY_gt_MMBBCannonballsObjectiveUIHandler;
trigger libBBAY_gt_MMBBCannonballsDoubloonDropped;
trigger libBBAY_gt_MMBBCannonballsShootingStart;
trigger libBBAY_gt_MMBBCannonballsShootingEnd;
trigger libBBAY_gt_MMBBCannonballsGameOver;
trigger libBBAY_gt_MMBBCannonballsHeroAITeamMapLogic;
trigger libBBAY_gt_MMBlackheartsBayHeroAIStateLogic;
trigger libBBAY_gt_MMBBHeroAIGhostShipShootingEnds;
trigger libBBAY_gt_MMBBHeroAIFollowerShouldTurnInDoubloons;
trigger libBBAY_gt_MMBBPingCallbackPlayerPingsDoubloonTurnIn;
trigger libBBAY_gt_MMBBPingCallbackPlayerPingsTreasureChest;
trigger libBBAY_gt_MMBB_DebugCannonballsDisableEvent;
trigger libBBAY_gt_MMBB_DebugCannonballsEventStart;
trigger libBBAY_gt_MMBB_DebugTriggerBombard;

// Library Initialization
void libBBAY_InitVariables ();

