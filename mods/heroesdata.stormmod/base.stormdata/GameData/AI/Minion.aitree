<?xml version="1.0" encoding="us-ascii"?>
<tree root="Root" period="4">

    <!-- UPDATE WAYPOINTS -->
    
    <node id="UpdateWaypoints" name="UpdateWaypoints" type="UpdateLaneVariables" comment="Update our battle standard and next waypoint locations">
        <property name="LaneIndex" value="Lane Index"/>
        <property name="NextWaypointIndex" value="Next Waypoint Index"/>
        <property name="NextWaypoint" value="Next Way Point"/>
        <property name="MinRangeToWaypoint" value="4"/>
        <property name="BattleStandard" value="Battle Standard"/>
    </node>

    <!-- LEASH -->
    
    <node id="LeashAttackMinionsToLane" name="LeashAttackMinionsToLane" type="Attack" comment="Only attack minions closer to our battle standard than us. We don't need to ignore behind gate because we are far from lane (leashing).">
        <property name="Targets" value="1"/>
        <property name="MinRange" value="5"/>
        <property name="ClipCenter" valueSource="variable" value="Battle Standard"/>
        <property name="ClipRadius" valueSource="variable" value="Battle Standard Distance"/>
    </node>
    
    <node id="LeashAttackStructures" name="LeashAttackStructures" type="Attack" comment="Search for nearby structures to attack. We don't need to ignore behind gate because they will be attacked first.">
        <property name="RequireSameLaneForStructures" value="true"/>
        <property name="Targets" value="2"/>
        <property name="MinRange" value="7"/>
    </node>
    
    <node id="LeashAttackHeroesInRange" name="LeashAttackHeroesInRange" type="Attack" comment="Only attack heroes within attack range. We don't need to ignore behind gate because gates will be attacked first.">
        <property name="Targets" value="3"/>
    </node>
    
    <node id="LeashAttackHeroesToLane" name="LeashAttackHeroesToLane" type="Attack" comment="Only attack heroes closer to our battle standard than us. We don't need to ignore behind gate because gates will be attacked first.">
        <property name="Targets" value="3"/>
        <property name="MinRange" value="7"/>
        <property name="ClipCenter" valueSource="variable" value="Battle Standard"/>
        <property name="ClipRadius" valueSource="variable" value="Battle Standard Distance"/>
    </node>
    
    <node id="LeashToLane" name="LeashToLane" type="MoveToPoint" comment="Move back to our battle standard">
        <property name="Target" valueSource="variable" value="Next Way Point"/>
        <property name="Acquire" value="false"/>
    </node>

    <node id="LeashDistanceCheck" name="LeashDistanceCheck" type="UnitDistance" comment="Check to see if we should leash or continue leashing">
        <property name="Unit" valueSource="intrinsic" value="Self"/>
        <property name="Point" valueSource="variable" value="Battle Standard"/>
        <property name="AlreadyActive" value="Leashing"/>
        <property name="MinRange" value="3.5" comment="Range to Stop leashing. We want this to be small to stop footmen bouncing between lane and hero. We want this to be large to allow AI to start fighting or advancing sooner, especially when there is a large swarm of AI."/>
        <property name="MaxRange" value="9" comment="Range to start leashing at."/>
        <property name="Invert" value="true"/>
        <property name="Distance" value="Battle Standard Distance"/>
    </node>
    
    <node id="LeashSelect" name="LeashSelect" type="Select" comment="Evaluate children in order.">
        <insertChild id="LeashAttackMinionsToLane"/>
        <insertChild id="LeashAttackStructures"/>
        <insertChild id="LeashAttackHeroesInRange"/>
        <insertChild id="LeashAttackHeroesToLane"/>
        <insertChild id="LeashToLane"/>
    </node>

    <node id="Leash" name="Leash" type="And" comment="If too far away from battle standard, move back to it, but still fight on the way.">
        <variable name="Battle Standard Distance" type="Number" comment="The distance the unit is to their battle standard."/>        
        <variable name="Leashing" type="Boolean" value="false"/>
        <insertChild id="LeashDistanceCheck"/>
        <insertChild id="LeashSelect"/>
    </node>
    
    <!-- LANE -->

    <node id="AttackMinions" name="AttackMinions" type="Attack" comment="Search for nearby minions to attack">
        <property name="Targets" value="1"/>
        <property name="IgnoreBehindGate" value="true"/>
        <property name="MinRange" value="5"/>
    </node>
    
    <node id="AttackStructures" name="AttackStructures" type="Attack" comment="Search for nearby structures to attack. We don't need to ignore behind gate because they will be attacked first.">
        <property name="RequireSameLaneForStructures" value="true"/>
        <property name="Targets" value="2"/>
        <property name="MinRange" value="7"/>
    </node>
    
    <node id="AttackHeroes" name="AttackHeroes" type="Attack" comment="Search for nearby heroes to attack. We don't need to ignore behind gate because gates will be attacked first.">
        <property name="Targets" value="3"/>
        <property name="MinRange" value="7"/>
    </node>

    <node id="WaitForStasisStructures" name="WaitForStasisStructures" type="Attack" comment="Search for nearby stasis structures and move to attack range then hold.">
        <property name="RequireSameLaneForStructures" value="true"/>
        <property name="Targets" value="2"/>
        <property name="MinRange" value="7"/>
        <property name="StasisEnemies" value="true"/>
    </node>

    <node id="Advance" name="Advance" type="MoveToPoint" comment="Move towards our next waypoint.">
        <property name="Target" valueSource="variable" value="Next Way Point"/>
        <property name="Acquire" value="true"/>        
    </node>
    
    <node id="HoldPosition" name="HoldPosition" type="MoveToUnit" comment="If we can't path to the way point or the hero, just hang out">
        <property name="Target" valueSource="intrinsic" value="Self"/>
        <property name="Acquire" value="true"/>
        <property name="HoldIfInRange" value="true"/>
    </node>
    
    <!-- ROOT -->
    
    <node id="Root" name="Root" type="Select" comment="Evaluate children in order.">
        <variable name="Lane Index" type="Integer"/>
        <variable name="Next Waypoint Index" type="Integer"/>
        <variable name="Next Way Point" type="Point"/>
        <variable name="Battle Standard" type="Point" comment="The point along the lane that is the most forward we have been."/>
        <insertChild id="UpdateWaypoints"/>
        <insertChild id="Leash"/>
        <insertChild id="AttackMinions"/>
        <insertChild id="AttackStructures"/>
        <insertChild id="AttackHeroes"/>
        <insertChild id="WaitForStasisStructures"/>
        <insertChild id="Advance"/>
        <insertChild id="HoldPosition"/>
    </node>
</tree>
