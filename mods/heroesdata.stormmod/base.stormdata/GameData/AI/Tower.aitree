<?xml version="1.0" encoding="us-ascii"?>
<tree root="RootConditional">
  <!-- ********Attack Selector Depth 3 Nodes**************** -->
  <node id="CurrentTargetNotHero" name="CurrentTargetNotHero" type="UnitFilterMatch" comment="Check to see if our current target is a hero">
    <property name="Unit" valueSource="variable" value="Current Target"/>
    <property name="Filter" value="-;Hero"/>
  </node>

  <node id="NoIgnoredByTowerAI" name="NoIgnoredByTowerAI" type="UnitHasBehavior" comment="Chek to see if the current target has Ingored by Tower AI">
    <property name="Unit" valueSource="variable" value="Current Target"/>
    <property name="Behavior" value="IgnoredByTowerAI"/>
    <property name="Not" value="true"/>
  </node>

  <node id="NoTowerAIPriority2" name="NoTowerAIPriority2" type="UnitHasBehavior" comment="Chek to see if the current target has Tower AI Priority 2">
    <property name="Unit" valueSource="variable" value="Current Target"/>
    <property name="Behavior" value="TowerAIPrioritzedTarget2"/>
    <property name="Not" value="true"/>
  </node>

  <node id="AttackCurrentTarget" name="AttackCurrentTarget" type="Attack" comment="Tell the tower to continue attackin its current target">
    <property name="Target" valueSource="variable" value="CurrentTarget"/>
  </node>

  <!-- ********Attack Selector Depth 2 Nodes**************** -->

  <node id="CurrentTargetIsValid" name="CurrentTargetIsValid" type="And" comment="Check to see if our current target is still valid">
    <insertChild id="CurrentTargetNotHero"/>
    <insertChild id="NoIgnoredByTowerAI"/>
    <insertChild id="NoTowerAIPriority2"/>
    <insertChild id="AttackCurrentTarget"/>
  </node>

  <node id="DestroyTargetingRing" name="DestroyTargetingItem" type="GalaxyEvent" comment="Send a galaxy event to destroy the targeting ring">
    <property name="Event" value="DestoryTowerTargetingRing"/>
    <property name="TriggeringUnit" valueSource="instrinsic" value="self"/>
  </node>

  <!-- ********Attack Selector Depth 1 Nodes**************** -->

  <node id="StillAttackingCurrentTarget" name="StillAttackingCurrentTarget" type="Or" comment="See if we can still attack our current target, if not destory ring">
    <insertChild id="CurrentTargetIsValid"/>
    <insertChild id="DestroyTargetingRing"/>
  </node>

  <node id="AttackMinions" name="AttackMinions" type="Attack" comment="Search for nearby minions to attack">
    <property name="Filter" value="Biological;-"/>
    <property name="AttackedUnit" valueSource="variable" value="Current Target"/>
  </node>

  <node id="AttackSummons" name="AttackSummons" type="Attack" comment="Search for nearby summoned units to attack">
    <property name="Filter" value="Summoned;-"/>
    <property name="ExcludedBehaviors" value="IgnoredByTowerAI"/>
    <property name="AttackedUnit" valueSource="variable" value="Current Target"/>
  </node>

  <node id="LookForAttackPriority1" name="LookForSummon" type="And" comment="Look for a summon to attack and destroy the targeting ring if we find one">
    <insertChild id="AttackSummons"/>
    <insertChild id="DestroyTargetingRing"/>
  </node>
  <node id="FindAnyTowerPrioity2" name="FindAnyTowerPrioity2" type="Attack" comment="Look for a nearby enemy with attack priority 2 behavior">
    <property name="RequiredBehaviors" value="TowerAIPrioritzedTarget2"/>
    <property name="AttackedUnit" valueSource="variable" value="Current Target"/>
  </node>

  <node id="CurrentTargetIsValidHero" name="CurrentTargetIsValidHero" type="And" comment="Check to see if our current target is still valid, allowing hereoes this time">
    <insertChild id="NoIgnoredByTowerAI"/>
    <insertChild id="AttackCurrentTarget"/>
  </node>

  <node id="AttackHero" name="AttackHero" type="Attack" comment="Look for a nearby enemy heroes to attack">
    <property name="Filter" value="Hero;-"/>
    <property name="AttackedUnit" valueSource="variable" value="Current Target"/>
  </node>

  <!-- ********ATTACK SELECTOR**************** -->
  <node id="AttackSelector" name="AttackSelector" type="Select" comment="Tower Can Attack, Pick Target">
    <insertChild id="CurrentTargetIsValid"/>
    <insertChild id="AttackMinions"/>
    <insertChild id="AttackSummons"/>
    <insertChild id="FindAnyTowerPrioity1"/>
    <insertChild id="FindAnyTowerPrioity2"/>
    <insertChild id="CurrentTargetIsValidHero"/>
    <insertChild id="AttackHero"/>
  </node>
  
  <!-- **************ATTACK CONDITIONS*********-->
  <node id="HasAmmoDisabler" name="HasAmmoDisabler" type="UnitHasBehavior" comment="Chek to see if the tower has the Ammod Disabler Behavior">
    <property name="Unit" valueSource="intrinsic" value="Self"/>
    <property name="Behavior" value="StructureAmmoDisabler"/>
  </node>

  <node id="IsPassive" name="IsPassive" type="UnitFilterMatch" comment="Chek to see if the tower is flagged as Passive">
    <property name="Unit" valueSource="intrinsic" value="Self"/>
    <property name="Filter" value="Passive;-"/>
  </node>

  <node id="NoNearbyEnemies" name="NoNearbyEnemies" type="UnitGroupCount" comment="Check to see if there are any enemies nearby">
    <property name="UnitGroup" valueSource="intrinsic" value="Enemies"/>
    <property name="Evaluation" value="Equals"/>
    <property name="Count" value="0"/>
  </node>

  <!-- ********ATTACK CONDITIONS **************** -->
  <node id="AttackConditions" name="AttackConditions" type="Or" comment="Conditional Checks to Make Sure We Can Attack">
    <!-- Has Ammo Disabler-->
    <insertChild id="HasAmmoDisabler"/>
    <!-- Is Passive-->
    <insertChild id="IsPassive"/>
    <insertChild id="NoNearbyEnemies"/>
  </node>
  
  <!--- Unable To Attack? -->
  <node id="UnableToAttack" name="UnableToAttack" type="And" comment="Check to see if we are prevented from attacking and destroy our targeting ring if we are">
    <insertChild id="AttackConditions"/>
    <insertChild id="DestroyTargetingRing"/>
  </node>
  
  <!-- ********ROOT**************** -->
  <node id="RootConditional" name="RootConditional" type="Or" comment="Root For Tower AI Think Tree">
    <variable name="Current Target" temp="false" type="Point" value="noUnit"/>
    <insertChild id="UnableToAttack"/>
    <insertChild id="AttackSelector"/>
  </node>
</tree>

